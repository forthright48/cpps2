const mongoose = require('mongoose');
const Setting = mongoose.model('Setting');
const _ = require('lodash');

const settings = {
  invite_only: false,
  private_site: false,
};

Setting.find({}).exec()
  .then(function(pairs){
    return _.forEach(pairs, function(pair){
      settings[pair.key] = pair.value;
    })
  })
  .catch(console.log);

module.exports = {
  getKey(key){
    return settings[key];
  },
  setKey(key, value){
    return Setting.findOneAndUpdate({key}, {key, value}, {upsert: true}).exec()
      .then(function(){
        return settings[key] = value;
      })
  },
  getAll() {
    return settings;
  }
}
